stages:
- build
- pages

build:
  stage: build
  script:
    - dnf install -y meson python3-pip gtk4-devel gobject-introspection-devel
    - pip3 install furo mypy sphinx coverage
    - mypy gtkblueprinttool
    - coverage run -m unittest
    - coverage html
    - meson _build -Ddocs=true
    - ninja -C _build
    - ninja -C _build test
    - ninja -C _build install
  artifacts:
    paths:
      - _build
      - htmlcov

pages:
  stage: pages
  dependencies:
    - build
  script:
    - mv _build/docs/en public
    - mv htmlcov public/coverage
  artifacts:
    paths:
      - public
  only:
    - main
