stages:
- build
- pages

build:
  image: registry.gitlab.gnome.org/jwestman/blueprint-compiler
  stage: build
  script:
    - mypy blueprintcompiler
    - coverage run -m unittest
    - coverage html
    - coverage xml
    - meson _build -Ddocs=true
    - ninja -C _build
    - ninja -C _build test
    - ninja -C _build install
  artifacts:
    paths:
      - _build
      - htmlcov
    reports:
      cobertura: coverage.xml

pages:
  stage: pages
  dependencies:
    - build
  script:
    - mv _build/docs/en public
    - mv htmlcov public/coverage
  artifacts:
    paths:
      - public
  only:
    - main
